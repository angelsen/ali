name: tmux
version: 2.0
description: Tmux window manager control with smart parsing
# When this plugin is active
context:
  env_required: TMUX
# Plugin vocabulary
vocabulary:
  verbs: [CREATE, DELETE, LIST, GO, SWITCH, SWAP, RENAME]
  verb_aliases:
    KILL: DELETE
    REMOVE: DELETE
    CLOSE: DELETE
    SELECT: GO
    MOVE: GO
    NAVIGATE: GO
  objects: [PANE, PANES, WINDOW, WINDOWS, SESSION, SESSIONS, ROW, COL]
  directions: [left, right, up, down, above, below]
  clauses: [WITH, FROM, TO]
  target_patterns:
    - {regex: "^[\\w-]+:\\d+\\.\\d+$"} # session:window.pane
    - {regex: "^[\\w-]+:\\d+$"} # session:window
    - {regex: "^\\.\\d+$"} # .1, .2 (pane refs)
    - {regex: "^:\\d+$"} # :1, :2 (window refs)
    - {regex: "^[\\w-]+$"} # session names
    - "." # Current pane
    - ":" # Current window
    - ".THIS" # Current pane (explicit)
    - ":THIS" # Current window (explicit)
    - "THIS" # Current session
    - "CURRENT" # Current session (alias)
    - ".?" # Visual pane selector
    - ":?" # Visual window selector
    - "?" # Visual selector (context-dependent)
# Token parsing rules
parsing:
  token_rules:
    # Rule 1: First token might be object
    - match: {position: 0, in_set: objects}
      action: set
      field: object
      transform: upper
    # Rule 2: Directions
    - match: {in_set: directions}
      action: set
      field: direction
      transform: lower
    # Rule 3: Clauses consume next token
    - match: {in_set: clauses}
      action: consume_next
      field: "{token_lower}"
    # Rule 4: Target patterns
    - match: {matches_patterns: true}
      action: set
      field: target
    # Rule 5: Everything else goes to args
    - match: {else: true}
      action: accumulate
      field: args
# Inference rules for smart behavior
inference:
  rules:
    # Infer object from target prefix
    - when: {target: "^\\.", object: null}
      set: {object: PANE}
    - when: {target: "^:", object: null}
      set: {object: WINDOW}
    - when: {target: "^(THIS|CURRENT)$", object: null}
      set: {object: SESSION}
    # Smart visual selector inference
    - when: {verb: SWAP, target: "^\\.$", with: "^\\?$"}
      transform: {with: ".?"} # Make visual selector explicit
    - when: {verb: SWAP, target: "^:$", with: "^\\?$"}
      transform: {with: ":?"}
    # Default ? based on verb
    - when: {verb: GO, target: "^\\?$", object: null}
      set: {object: PANE}
      transform: {target: ".?"}
    - when: {verb: SWITCH, target: "^\\?$", object: null}
      set: {object: SESSION}
# Field transformations
transformations:
  field_aliases:
    from: target # FROM .2 becomes target: .2
    to: name # TO something becomes name: something
  field_transformations:
    target:
      ".": "" # . → "" (current pane)
      ":": "" # : → "" (current window)
      ".THIS": "" # .THIS → "" (current pane)
      ":THIS": "" # :THIS → "" (current window)
      "THIS": "" # THIS → "" (current session)
      "CURRENT": "" # CURRENT → "" (current session)
# Validation rules
validation:
  allowed_directions:
    PANE: [left, right, up, down, above, below]
    COL: [left, right]
    ROW: [up, down, above, below]
  allowed_params:
    "CREATE PANE": [direction, target, from]
    "CREATE WINDOW": [target, from]
    "CREATE ROW": [direction, target, from]
    "CREATE COL": [direction, target, from]
    "DELETE PANE": [target]
    "DELETE WINDOW": [target]
    "DELETE SESSION": [target]
    "LIST PANES": []
    "LIST WINDOWS": []
    "GO PANE": [target]
    "GO WINDOW": [target]
    "SWITCH PANE": [target]
    "SWITCH WINDOW": [target]
    "SWITCH SESSION": [target]
    "SWAP PANE": [target, with]
    "SWAP WINDOW": [target, with]
    "RENAME WINDOW": [name, target, to]
    "RENAME SESSION": [name, target, to]
# Field expansions for command templates
expansions:
  direction:
    type: map
    field: direction
    mappings:
      PANE:
        left: "-h -b"
        right: "-h"
        up: "-v -b"
        down: "-v"
      COL:
        left: "-h -f -b"
        right: "-h -f"
      ROW:
        up: "-v -f -b"
        down: "-v -f"
# Command templates
commands:
  # Visual selector commands
  - match: {verb: GO, object: PANE, target: ".?"}
    exec: "tmux display-panes"
  - match: {verb: DELETE, object: PANE, target: ".?"}
    exec: "tmux display-panes 'kill-pane -t \"%%\"'"
  - match: {verb: SWAP, object: PANE, with: ".?"}
    exec: "tmux display-panes 'swap-pane -t \"%%\"'"
  - match: {verb: GO, object: WINDOW, target: ":?"}
    exec: "tmux choose-window"
  - match: {verb: DELETE, object: WINDOW, target: ":?"}
    exec: "tmux choose-window 'kill-window -t \"%%\"'"
  - match: {verb: SWITCH, object: SESSION, target: "?"}
    exec: "tmux choose-session"
  # Regular commands
  - match: {verb: CREATE, object: PANE}
    exec: "tmux split-window {direction} -t {target}"
  - match: {verb: CREATE, object: COL}
    exec: "tmux split-window {direction} -t {target}"
  - match: {verb: CREATE, object: ROW}
    exec: "tmux split-window {direction} -t {target}"
  - match: {verb: CREATE, object: WINDOW}
    exec: "tmux new-window -t {target}"
  - match: {verb: DELETE, object: PANE}
    exec: "tmux kill-pane -t {target}"
  - match: {verb: DELETE, object: WINDOW}
    exec: "tmux kill-window -t {target}"
  - match: {verb: DELETE, object: SESSION}
    exec: "tmux kill-session -t {target}"
  - match: {verb: LIST, object: PANES}
    exec: "tmux list-panes"
  - match: {verb: LIST, object: WINDOWS}
    exec: "tmux list-windows"
  - match: {verb: GO, object: PANE}
    exec: "tmux select-pane -t {target}"
  - match: {verb: GO, object: WINDOW}
    exec: "tmux select-window -t {target}"
  - match: {verb: SWITCH, object: PANE}
    exec: "tmux select-pane -t {target}"
  - match: {verb: SWITCH, object: WINDOW}
    exec: "tmux select-window -t {target}"
  - match: {verb: SWITCH, object: SESSION}
    exec: "tmux switch-client -t {target}"
  - match: {verb: SWAP, object: PANE}
    exec: "tmux swap-pane -s {target} -t {with}"
  - match: {verb: SWAP, object: WINDOW}
    exec: "tmux swap-window -s {target} -t {with}"
  - match: {verb: RENAME, object: WINDOW}
    exec: "tmux rename-window {name}"
  - match: {verb: RENAME, object: SESSION}
    exec: "tmux rename-session {name}"
