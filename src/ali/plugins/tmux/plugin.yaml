name: tmux
version: 2.0
description: Terminal multiplexer - pane and window management
provides:
  pane:
    type: service
    capabilities: [create, split, focus, close]
  window:
    type: service
    capabilities: [create, focus, close]
  session:
    type: service
    capabilities: [create, switch, close]
context:
  requires_env: TMUX
# Plugin grammar definitions - how to parse field types
grammar:
  target:
    pattern: "^\\.[0-9]+$|^:[0-9]+$|^\\?$|^THIS$|^CURRENT$"
    description: "Pane/window selectors (.1, :2, ?, THIS)"
  direction:
    values: [left, right, up, down, top, bottom]
    transform: lower
    description: "Split directions"
  object:
    values: [PANE, WINDOW, SESSION]
    transform: upper
    description: "Tmux objects"
  clause:
    values: [AS, WITH, IN]
    transform: upper
    description: "Command clauses"
  panes:
    pattern: "^[0-9]+$"
    description: "Pane indices like 012"
  fraction:
    pattern: "^\\d+/\\d+$"
    description: "Fractions like 1/2, 2/3"
# Vocabulary for verb recognition
vocabulary:
  verbs: [GO, DELETE, SPLIT, CREATE, WIDTH, HEIGHT]
# Verb expectations with defaults
expectations:
  GO: [target]
  DELETE: ["object?", "target?"]
  SPLIT: ["target?", "direction?=right"]
  CREATE: [object, "direction?"]
  WIDTH: [panes, "clause?", "fraction?"]
  HEIGHT: [panes, "clause?", "fraction?"]
# Safe inference rules
inference:
  # GO ? â†’ visual pane selector
  - when: {verb: GO, target: "?"}
    transform: {target: ".?"}
  # Target prefix implies object
  - when: {verb: DELETE, target: "^\\.", object: null}
    set: {object: PANE}
  - when: {verb: DELETE, target: "^:", object: null}
    set: {object: WINDOW}
  # SPLIT always means pane
  - when: {verb: SPLIT}
    set: {object: PANE}
commands:
  # Navigation
  - match: {verb: GO, target: ".?"}
    exec: "tmux display-panes"
  - match: {verb: GO, target: present}
    exec: "tmux select-pane -t {target}"
    
  # Split pane using template composition
  # This ONE pattern replaces ALL the direction-specific patterns!
  - match: {verb: SPLIT, object: PANE, target: present, direction: present}
    exec: "tmux select-pane -t {target} && {split_{direction}}"
  
  - match: {verb: SPLIT, object: PANE, direction: present}
    exec: "{split_{direction}}"
    
  # Split with default direction (right)
  - match: {verb: SPLIT, object: PANE}
    exec: "{split_right}"
    
  # Delete operations
  - match: {verb: DELETE, object: PANE, target: present}
    exec: "tmux kill-pane -t {target}"
  - match: {verb: DELETE, object: WINDOW, target: present}
    exec: "tmux kill-window -t {target}"
    
  # Window operations
  - match: {verb: CREATE, object: WINDOW}
    exec: "tmux new-window"
    
  # Pane distribution commands
  - match: {verb: WIDTH, panes: present, fraction: present}
    exec: "ali --plugin-script tmux.distribute --dimension width --panes {panes} --fraction {fraction}"
  - match: {verb: WIDTH, panes: present}
    exec: "ali --plugin-script tmux.distribute --dimension width --panes {panes}"
  - match: {verb: HEIGHT, panes: present, fraction: present}
    exec: "ali --plugin-script tmux.distribute --dimension height --panes {panes} --fraction {fraction}"
  - match: {verb: HEIGHT, panes: present}
    exec: "ali --plugin-script tmux.distribute --dimension height --panes {panes}"
# Service templates - simple named command fragments
services:
  # Directional splits
  split_left: "tmux split-window -h -b"
  split_right: "tmux split-window -h"
  split_up: "tmux split-window -v -b"
  split_down: "tmux split-window -v"
  split_top: "tmux split-window -v -b"
  split_bottom: "tmux split-window -v"
  
  # Send commands to existing panes
  send_to: "tmux send-keys -t"
  
  # Window and session templates  
  new_window: "tmux new-window"
  new_session: "tmux new-session -d"
  
  # Selection/focus templates
  select_pane: "tmux select-pane -t"
  select_window: "tmux select-window -t"
  focus: "tmux select-pane -t"